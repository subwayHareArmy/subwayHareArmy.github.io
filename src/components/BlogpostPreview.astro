---
import dayjs from "dayjs";

import { Icon } from "./Icon/Icon";
import Picture from "./Picture.astro";
import type { DetailedPeerCertificate } from "tls";

interface Props {
  slug: string
  title: string;
  description: string;
  datePublished: Date;
  dateModified: Date;
  url?: string;
  repo?: string;
  img?: ImageMetadata[];
  imgAlt?: string;
  ogImage?: ImageMetadata;
  tags?: string[];
  visibility: string;
}

const { slug, title, description, datePublished, dateModified, 
  url, repo, img, imgAlt, ogImage, tags, visibility } = Astro.props;

const date = dayjs(datePublished).format("MMMM YYYY");
const blogpostPath = "/blog/" + slug;
---

{ visibility==="public" && (
  <div class="blogpost">
    {
      img && imgAlt && (
        <a class="img" href={blogpostPath}>
          <Picture img={img} imgAlt={imgAlt} />
        </a>
      )
    }
    <div class="details">
      <a class="title" href={blogpostPath}>
        <h2>{title}</h2>
      </a>
      <div class="description">
        {description}{" "}
        <time class="date" datetime={datePublished.toString()}>{date}</time>
      </div>
      <footer class="links">
        {
          url && (
          <a class="link" href={url}>
              <Icon icon="link" size="small" />
              <span class="url">{url.replace(/^https?:\/\//, "")}</span>
          </a>
          )
        }
        {
          repo && (
            <a class="link" href={`https://github.com/${repo}`}>
              <Icon icon="github" size="small" />
              <span class="url">{repo}</span>
            </a>
          )
        }
      </footer>
    </div>
  </div>
)}

<style lang="scss">
  .blogpost {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-l);
  }

  .details {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-s);
    width: 100%;
  }

  .img {
    background-color: var(--mauve-3);
    border-radius: var(--radius-m);
    overflow: hidden;
    width: 100%;

    &:hover {
      background-color: var(--pink-4);
    }
  }

  .description {
    line-height: 1.4;
  }

  .date {
    color: var(--mauve-11);

    &::before {
      content: "â€” ";
      white-space: pre;
    }
  }

  .links {
    display: flex;
    flex-flow: row wrap;
    max-width: 100%;
    column-gap: var(--space-m);
  }

  .link {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    color: var(--mauve-11);
    padding-block: var(--space-2xs);
    max-width: 100%;
    line-height: 1.1;

    &:hover {
      color: var(--mauve-12);
      text-decoration: underline;
      text-decoration-color: var(--mauve-7);
      text-underline-offset: 0.1em;
    }

    .url {
      word-wrap: break-word;
      min-width: 1%;
    }
  }
</style>
